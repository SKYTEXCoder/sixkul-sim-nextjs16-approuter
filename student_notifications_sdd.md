# ðŸ“£ Student Notifications â€” Specification-Driven Development (SDD)

## Feature Name

**Notifikasi Saya (Student Notifications)**

## Target Role

**STUDENT / SISWA**

## Model Executor

**Claude Opus 4.5 Thinking**

---

## 1. Goal & Success Definition

### Primary Goal

Implement a **fully functional, end-to-end Student Notifications system** that is usable by authenticated student users and respects their preferences.

### The feature is considered **COMPLETE** when a student can:

- âœ… Receive notifications generated by system events
- âœ… View notifications in a dedicated page
- âœ… See unread vs read state
- âœ… Mark notifications as read
- âœ… Navigate back to the correct enrollment context
- âœ… Have all notification behavior gated by `StudentPreferences`

---

## 2. Scope Boundaries (VERY IMPORTANT)

### INCLUDED

- Student-side notifications only
- In-app notifications (no email / push)
- Core triggers only (MVP)
- Read / unread state
- Preference enforcement

### EXCLUDED (INTENTIONAL)

- âŒ Email notifications
- âŒ Push notifications
- âŒ Real-time WebSockets
- âŒ Admin / Pembina notification UI (will come later)
- âŒ Notification settings beyond existing toggles

---

## 3. Data Model (Prisma)

### Existing Model (Must Be Used)

You **MUST** use the already-existing `Notification` model in the schema.

If missing fields exist, you **MAY** add **ONLY IF REQUIRED**, but **DO NOT redesign** the model.

### Required Fields (Logical Minimum)

```ts
Notification {
  id
  user_id        // Student user
  enrollment_id  // Context anchor
  type           // ANNOUNCEMENT | ATTENDANCE | SCHEDULE | ENROLLMENT
  title
  message
  is_read
  created_at
}
```

---

## 4. Notification Ownership & Navigation Contract

### Canonical Rule (NON-NEGOTIABLE)

> **ALL student notifications MUST resolve back to an ENROLLMENT context**

### Therefore

- âŒ NO `/student/notifications/[id]`
- âŒ NO `/student/announcement/[id]`
- âŒ NO `/student/session/[id]`

### âœ… All notification clicks MUST navigate to

```text
/student/enrollments/[enrollment_id]
```

This rule is **absolute**.

---

## 5. Notification Triggers (MVP REQUIRED)

You **MUST** implement notification creation for the following events.

### 5.1 Announcement Published

- Triggered when a new announcement is created for an extracurricular
- Applies to **ACTIVE enrollments only**
- Gated by:

  - `StudentPreferences.notify_announcements === true`

### 5.2 Attendance Recorded

- Triggered when attendance is created for a session
- Applies to the enrollment owner
- Gated by:

  - `StudentPreferences.notify_attendance === true`

### 5.3 Schedule / Session Change

- Triggered when a session is:

  - created
  - updated
  - cancelled

- Applies to **ACTIVE enrollments**
- Gated by:

  - `StudentPreferences.notify_schedule_changes === true`

### 5.4 Enrollment Status Change

- Triggered when enrollment changes status:

  - `PENDING â†’ ACTIVE`
  - `ACTIVE â†’ ALUMNI / CANCELLED / REJECTED`

- **Always notify** (not gated)

---

## 6. Preference Enforcement (MANDATORY)

Before **ANY** notification is created:

1. Resolve `StudentPreferences` via shared resolver
2. Check the corresponding toggle
3. If disabled â†’ **DO NOT CREATE notification**

This applies **system-wide**.

---

## 7. Server-Side Data Layer

### New File

```text
src/lib/notification-data.ts
```

### Required Functions

```ts
getStudentNotifications(): {
  notifications: NotificationViewModel[]
  unreadCount: number
}

markNotificationAsRead(notificationId)
markAllNotificationsAsRead()
getUnreadNotificationCount()
```

### Rules

- Authenticate via Clerk
- Enforce **SISWA** role
- Query **only notifications owned by the user**
- Order by `created_at DESC`

---

## 8. Student Notifications Page

### Route

```text
/student/notifications
```

### Page Type

**React Server Component (RSC)**

### UI Requirements

- List of notifications
- Visual unread indicator
- Timestamp (Indonesian locale, `id-ID`)
- Empty state message:

> **â€œBelum ada notifikasiâ€**

### Interaction

- Clicking a notification:

  1. Marks it as read
  2. Navigates to `/student/enrollments/[id]`

---

## 9. Bell Icon Integration (Top Navbar)

### Required Behavior

- Show unread count badge
- If unread count > 0 â†’ badge visible

### Click Behavior (Choose ONE â€” MVP Allowed)

- **Option A:** Navigate to `/student/notifications`
- **Option B:** Dropdown preview (optional)

### Minimum Requirement

ðŸ‘‰ Clicking the bell **MUST** allow the student to access notifications.

---

## 10. Read / Unread Behavior

- Notifications default to `is_read = false`
- When clicked â†’ mark as read
- Optional:

  - â€œMark all as readâ€ button

âŒ No deletion required for MVP.

---

## 11. Global UX Contracts

### Cursor Pointer Rule (REQUIRED)

All clickable notification elements **MUST** use:

```css
cursor: pointer;
```

Applies to:

- Notification rows
- Bell icon
- Buttons

---

## 12. Error & Edge Handling

| Scenario             | Expected Behavior        |
| -------------------- | ------------------------ |
| Not logged in        | Redirect to `/sign-in`   |
| Wrong role           | Forbidden UI             |
| No notifications     | Empty state              |
| Preferences disabled | No notifications created |

---

## 13. Verification Checklist (MANDATORY)

Claude **MUST** verify:

- `/student/notifications` renders without 404
- Notifications appear from real DB data
- Unread count updates correctly
- Clicking notification navigates correctly
- Preferences disable notification creation
- Bell badge updates accurately
- Build passes (`npm run build`)

---

## 14. Completion Criteria (PASS / FAIL)

The feature is **FAILED** if:

- Notifications do not respect preferences
- Navigation goes anywhere other than enrollment detail
- Bell icon is static
- Notifications are created without triggers
- A student can see other usersâ€™ notifications

---

## 15. Instruction to Claude Opus 4.5 Thinking

> You **MUST** follow this SDD strictly.
> Do **NOT** infer, extend, or simplify requirements.
> If **ANY** uncertainty exists, **STOP and CONSULT** the project owner.
> Do not rush things. Take your very own personal time in implementing this end-to-end feature.

---

## 16. Test Credentials (FOR DEVELOPMENT & VERIFICATION ONLY)

If authentication is required during development or manual verification using **Clerk Authentication**, use the following **test student account**:

```text
Username: student_siti
Password: rtx5070ti16gbsiti
```

These credentials are **STRICTLY for local development and testing**. Do **NOT** hardcode them into the application or commit them to the repository.
